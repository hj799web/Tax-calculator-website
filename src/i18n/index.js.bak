/* eslint-disable */
// Lightweight i18n utility without external dependency
import { ref } from 'vue'
import en from './en.json'
import fr from './fr.json'

const overrides = 
{
  'en': {
    'how': {
      'footer': {
        'updated': 'This documentation was last updated: May 2025',
        'contact': 'For questions or feedback, please contact:',
        'back': 'Back to Calculator'
      },
      'sections': {
        'taxProcess': {
          'steps': {
            'apply': {
              'items': {
                'rrsp': 'RRSP deductions',
                'bpa': 'Basic personal amounts',
                'dependents': 'Dependent credits',
                'childCredits': 'Child credits',
                'dividendCredits': 'Dividend tax credits'
              }
            },
            'federal': {
              'items': {
                'determineTaxable': 'Determine taxable income',
                'applyRates': 'Apply federal tax rates by bracket',
                'subtractCredits': 'Subtract applicable federal credits'
              }
            },
            'provincial': {
              'items': {
                'applyRates': 'Apply provincial or territorial tax rates',
                'subtractCredits': 'Subtract applicable provincial credits'
              }
            },
            'payroll': {
              'items': {
                'cppqpp': 'CPP or QPP: 5.7% (11.4% self employed) up to the maximum',
                'ei': 'EI: 1.63% of employment income up to the maximum'
              }
            },
            'net': {
              'items': {
                'subtractTotal': 'Subtract total tax (federal + provincial + CPP or QPP + EI) from gross income'
              }
            }
          }
        },
        'income': {
          'body': 'Different income types follow different Canadian tax rules.',
          'employment': {
            'items': {
              'taxed': 'Taxed at regular rates',
              'cppEi': 'Subject to CPP or QPP and EI premiums'
            }
          },
          'self': {
            'items': {
              'taxed': 'Taxed at regular rates',
              'bothCpp': 'Subject to both employer and employee portions of CPP or QPP',
              'noEi': 'Not subject to EI premiums unless opted in'
            }
          },
          'gains': {
            'items': {
              'halfTaxable': '50% of capital gains are taxable',
              'dateTreatment': 'Different treatment before and after June 25 2024'
            }
          },
          'dividends': {
            'items': {
              'eligible': 'Eligible dividends are grossed up by 38% with a 15.02% federal credit',
              'ineligible': 'Ineligible dividends are grossed up by 15% with a 9% federal credit'
            }
          },
          'rrsp': {
            'items': {
              'reduces': 'RRSP contributions reduce taxable income'
            }
          }
        },
        'spendingViz': {
          'body': 'See how federal spending allocates every tax dollar.',
          'federal': {
            'body': 'Federal spending includes:',
            'items': {
              'health': 'Healthcare',
              'seniors': 'Support for seniors',
              'families': 'Children and families',
              'indigenous': 'Indigenous services',
              'ei': 'Employment Insurance and benefits',
              'defense': 'Defense and public safety',
              'debtService': 'Debt servicing',
              'publicDebt': 'Public debt charges',
              'operations': 'Government operations',
              'other': 'Other categories'
            }
          },
          'visualization': {
            'body': 'Switch between data views:',
            'items': {
              'y2023': '2022-2023 historical (Public Accounts)',
              'y2024': '2023-2024 proposed (Budget 2024)',
              'y2026': '2025-2026 projected estimates'
            }
          },
          'personal': {
            'body': 'Personal tax allocation shows the share of your contribution.'
          }
        },
        'benefits': {
          'accuracy': {
            'items': {
              'upToDate': 'Up-to-date tax brackets nationwide',
              'incomeTypes': 'Handles multiple income types',
              'credits': 'Includes core deductions and credits'
            }
          },
          'planning': {
            'items': {
              'rate': 'Surface your effective tax rate',
              'periods': 'Support for annual to hourly inputs',
              'rrsp': 'Visualise RRSP contribution impact'
            }
          },
          'transparency': {
            'items': {
              'allocation': 'Show where tax dollars go',
              'priorities': 'Highlight spending priorities',
              'connection': 'Connect taxes to public services'
            }
          },
          'education': {
            'items': {
              'literacy': 'Improve financial literacy',
              'demystify': 'Demystify the tax system',
              'decisions': 'Support informed decisions'
            }
          },
          'accessibility': {
            'items': {
              'free': 'Free to use',
              'noReg': 'No registration required',
              'mobile': 'Mobile friendly',
              'export': 'Exportable PDF results'
            }
          }
        },
        'tech': {
          'items': {
            'frontend': 'Frontend framework: Vue.js',
            'state': 'State management: Pinia',
            'viz': 'Visualisation: Chart.js',
            'styling': 'Responsive CSS styling',
            'validation': 'Form validation utilities',
            'export': 'PDF export support',
            'realtime': 'Real-time calculation engine',
            'controls': 'Custom interactive controls',
            'tooltips': 'Contextual tooltips',
            'autobalance': 'Auto balance algorithms'
          }
        },
        'data': {
          'body': 'Based on trusted Canadian fiscal data.',
          'items': {
            'rates': 'Tax rates and brackets: CRA and provincial agencies',
            'publicAccounts': 'Budget allocation: Public Accounts of Canada',
            'budget2024': 'Budget 2024 documentation'
          },
          'note': 'Educational only; consult a professional for advice.'
        },
        'simulator': {
          'body': 'Explore fiscal trade-offs with the Budget Simulator.',
          'features': {
            'items': {
              'controls': 'Interactive spending controls',
              'realtime': 'Real-time deficit or surplus updates',
              'viz': 'Visual budget impact charts',
              'autobalance': 'Auto-balance revenue option',
              'tooltips': 'Detailed tooltips per control'
            }
          },
          'mainCats': {
            'items': {
              'social': 'Social programs',
              'economic': 'Economic development',
              'security': 'Defense and security',
              'environment': 'Environmental protection',
              'international': 'International affairs'
            }
          },
          'howTo': {
            'items': {
              'adjust': 'Adjust sliders for each category',
              'monitor': 'Watch totals update instantly',
              'autobalance': 'Use auto balance to steady budgets',
              'details': 'Open info icons for context',
              'export': 'Export or share your plan'
            }
          },
          'results': {
            'items': {
              'totalRevenue': 'Total revenue: sum of all sources',
              'totalSpending': 'Total spending: combined outlays',
              'surplusDeficit': 'Surplus or deficit indicator',
              'debtToGdp': 'Debt-to-GDP ratio signal',
              'categoryImpacts': 'Category impacts: change per program'
            }
          },
          'tips': {
            'items': {
              'startSmall': 'Start with small adjustments',
              'autoBalance': 'Use auto balance for discipline',
              'watchDeficit': 'Watch deficit warnings',
              'interconnected': 'Remember categories interact',
              'reviewTooltips': 'Review tooltips for deeper context'
            }
          },
          'taxCalc': {
            'title': 'Understanding tax calculations',
            'body': 'Simplified effective rates show overall revenue change rather than exact filings.'
          },
          'personal': {
            'title': 'Personal income tax',
            'items': {
              'method': 'Average effective rates replace brackets',
              'baseRate': 'Base rate 21% (2024)',
              'baseAmount': 'Revenue change: $10B per point',
              'totalRevenue': 'Total revenue: $210B',
              'range': 'Slider range 0% to 50%',
              'credits': 'Credits and deferrals adjustable'
            }
          },
          'corporate': {
            'title': 'Corporate income tax',
            'items': {
              'method': 'Simplified rate structure',
              'baseRate': 'Base rate 15% (2024)',
              'baseAmount': 'Revenue change: $5.33B per point',
              'totalRevenue': 'Total revenue: $80B',
              'range': 'Slider range 0% to 40%',
              'expenditures': 'Corporate tax expenditures adjustable'
            }
          },
          'taxExpenditures': {
            'title': 'Tax expenditures and credits',
            'personal': {
              'title': 'Personal tax credits',
              'items': {
                'baseAmount': 'Base amount $120B gross',
                'netAmount': 'Net amount $102B after interactions',
                'impact': 'Adjust to impact personal income tax revenue'
              }
            },
            'corporate': {
              'title': 'Corporate tax expenditures',
              'items': {
                'baseAmount': 'Base amount $25B gross',
                'netAmount': 'Net amount $23.75B after interactions',
                'impact': 'Adjust to impact corporate income tax revenue'
              }
            }
          },
          'summary': 'A simplified model that emphasises overall fiscal impact rather than individual filings.'
        }
      },
      'faq': {
        'a1': 'Estimates are close but simplified and will not cover every situation.',
        'a2': 'All calculations stay in your browser; nothing is stored.',
        'a3': 'Updated yearly to follow new rates, brackets, and spending.',
        'a4': 'Designed for personal taxes, not business filings.',
        'a5': 'Spending data comes from Public Accounts and Budget 2024 documents.',
        'a6': 'Includes major credits but not every possible credit.',
        'a7': 'Shows how spending changes affect deficit, surplus, and debt-to-GDP.',
        'a8': 'Auto-balance adjusts revenue to keep the budget even.',
        'a9': 'Export your budget as a PDF with allocations and impacts.',
        'a10': 'Impact calculations are simplified; real-world interactions may differ.',
        'a11': 'Tooltips explain each category with spending levels and program notes.'
      }
    },
    'tour': {
      'steps': {
        'moreMobile': {
          'title': 'More',
          'body': 'On mobile the extra tabs live under More.'
        },
        'exportOptions': {
          'title': 'Export options',
          'body': 'Enable Include Full Breakdown then download the PDF.'
        },
        'spendingTaxExp': {
          'title': 'Tax expenditures',
          'body': 'Credits and deductions that reduce revenue.'
        },
        'spendingReset': {
          'title': 'Reset controls',
          'body': 'Each tile has a reset to baseline button.'
        },
        'resultsDeficit': {
          'title': 'Warnings',
          'body': 'Large deficits trigger a warning banner.'
        },
        'resultsDownload': {
          'title': 'Download',
          'body': 'Save charts using the download button.'
        }
      }
    },
    'simulator': {
      'yearSelector': {
        'aria': 'Fiscal year selector',
        'labels': {
          'y2024': '2023-2024'
        }
      }
    }
  },
  'fr': {
    'how': {
      'footer': {
        'updated': 'Derniere mise a jour: Mai 2025',
        'contact': 'Questions ou commentaires :',
        'back': 'Retour au calculateur'
      },
      'sections': {
        'taxProcess': {
          'steps': {
            'apply': {
              'items': {
                'rrsp': 'Deductions REER',
                'bpa': 'Montants personnels de base',
                'dependents': 'Credits pour personnes a charge',
                'childCredits': 'Credits pour enfants',
                'dividendCredits': 'Credits d impot sur dividendes'
              }
            },
            'federal': {
              'items': {
                'determineTaxable': 'Determiner le revenu imposable',
                'applyRates': 'Appliquer les taux federaux adequats',
                'subtractCredits': 'Soustraire les credits admissibles'
              }
            },
            'provincial': {
              'items': {
                'applyRates': 'Appliquer les taux provinciaux ou territoriaux',
                'subtractCredits': 'Soustraire les credits provinciaux admissibles'
              }
            },
            'payroll': {
              'items': {
                'cppqpp': 'RPC ou RRQ: 5,7 pourcent (11,4 pourcent travailleur autonome) jusqu au maximum',
                'ei': 'AE: 1,63 pourcent du revenu d emploi jusqu au maximum'
              }
            },
            'net': {
              'items': {
                'subtractTotal': 'Soustraire tous les impots du revenu brut'
              }
            }
          }
        },
        'income': {
          'body': 'Chaque type de revenu suit des regles fiscales canadiennes.',
          'employment': {
            'items': {
              'taxed': 'Impose aux taux habituels',
              'cppEi': 'Assujetti au RPC ou RRQ et a l AE'
            }
          },
          'self': {
            'items': {
              'taxed': 'Impose aux taux habituels',
              'bothCpp': 'Cotise aux deux parts du RPC ou RRQ',
              'noEi': 'Pas d AE sauf option'
            }
          },
          'gains': {
            'items': {
              'halfTaxable': '50 pourcent des gains en capital imposables',
              'dateTreatment': 'Regles differentes apres le 25 juin 2024'
            }
          },
          'dividends': {
            'items': {
              'eligible': 'Dividendes determines majoration 38 pourcent + credit 15,02 pourcent',
              'ineligible': 'Dividendes ordinaires majoration 15 pourcent + credit 9 pourcent'
            }
          },
          'rrsp': {
            'items': {
              'reduces': 'Contributions REER reduisent le revenu imposable'
            }
          }
        },
        'spendingViz': {
          'body': 'Visualiser l affectation de vos impots federaux.',
          'federal': {
            'body': 'Depenses federales incluant :',
            'items': {
              'health': 'Sante',
              'seniors': 'Aines',
              'families': 'Enfants et familles',
              'indigenous': 'Services autochtones',
              'ei': 'AE et prestations',
              'defense': 'Defense et securite publique',
              'debtService': 'Service de la dette',
              'publicDebt': 'Interets sur la dette',
              'operations': 'Fonctionnement du gouvernement',
              'other': 'Autres categories'
            }
          },
          'visualization': {
            'body': 'Trois vues budgetaires :',
            'items': {
              'y2023': '2022-2023 donnees historiques',
              'y2024': '2023-2024 propositions Budget 2024',
              'y2026': '2025-2026 projections'
            }
          },
          'personal': {
            'body': 'Ventilation de votre impot federal par categorie.'
          }
        },
        'benefits': {
          'accuracy': {
            'items': {
              'upToDate': 'Taux et paliers a jour',
              'incomeTypes': 'Prise en charge de differents revenus',
              'credits': 'Principales deductions et credits inclus'
            }
          },
          'planning': {
            'items': {
              'rate': 'Comprendre le taux effectif',
              'periods': 'Planifier par periode (annuel a horaire)',
              'rrsp': 'Visualiser l impact des REER'
            }
          },
          'transparency': {
            'items': {
              'allocation': 'Montrer l affectation des impots',
              'priorities': 'Expliquer les priorites de depenses',
              'connection': 'Relier impots et services publics'
            }
          },
          'education': {
            'items': {
              'literacy': 'Ameliorer la litteratie financiere',
              'demystify': 'Demystifier le systeme fiscal',
              'decisions': 'Aider aux decisions eclairees'
            }
          },
          'accessibility': {
            'items': {
              'free': 'Gratuit',
              'noReg': 'Sans inscription',
              'mobile': 'Optimisation mobile',
              'export': 'Resultats PDF exportables'
            }
          }
        },
        'tech': {
          'items': {
            'frontend': 'Frontend : Vue.js',
            'state': 'Etat : Pinia',
            'viz': 'Visualisation : Chart.js',
            'styling': 'Styles CSS responsives',
            'validation': 'Validation des formulaires',
            'export': 'Export PDF',
            'realtime': 'Calculs temps reel',
            'controls': 'Commandes interactives',
            'tooltips': 'Info bulles dynamiques',
            'autobalance': 'Equilibrage automatique'
          }
        },
        'data': {
          'body': 'Donnees canadiennes reconnues.',
          'items': {
            'rates': 'Taux et paliers : ARC et provinces',
            'publicAccounts': 'Affectation : Comptes publics du Canada',
            'budget2024': 'Budget 2024 : documents officiels'
          },
          'note': 'Usage educatif; consulter un professionnel pour des conseils.'
        },
        'simulator': {
          'body': 'Simulateur pour explorer les compromis budgetaires.',
          'features': {
            'items': {
              'controls': 'Commandes interactives des depenses',
              'realtime': 'Calcul du solde en temps reel',
              'viz': 'Visualisation des impacts',
              'autobalance': 'Equilibrage automatique',
              'tooltips': 'Info bulles detaillees'
            }
          },
          'mainCats': {
            'items': {
              'social': 'Programmes sociaux',
              'economic': 'Developpement economique',
              'security': 'Defense et securite',
              'environment': 'Environnement',
              'international': 'Affaires internationales'
            }
          },
          'howTo': {
            'items': {
              'adjust': 'Ajuster les curseurs de depenses',
              'monitor': 'Suivre depenses et solde en direct',
              'autobalance': 'Utiliser l equilibrage auto',
              'details': 'Consulter les icones info',
              'export': 'Exporter ou partager le plan'
            }
          },
          'results': {
            'items': {
              'totalRevenue': 'Recettes totales : somme des sources',
              'totalSpending': 'Depenses totales : depenses combinees',
              'surplusDeficit': 'Solde budgetaire : surplus ou deficit',
              'debtToGdp': 'Dette PIB : indicateur',
              'categoryImpacts': 'Impact par categorie'
            }
          },
          'tips': {
            'items': {
              'startSmall': 'Commencer par de petits ajustements',
              'autoBalance': 'Utiliser l equilibrage auto',
              'watchDeficit': 'Surveiller les avertissements de deficit',
              'interconnected': 'Tenir compte des liens entre categories',
              'reviewTooltips': 'Lire les info bulles pour le contexte'
            }
          },
          'taxCalc': {
            'title': 'Comprendre les calculs',
            'body': 'Taux effectifs simplifies pour illustrer l impact global.'
          },
          'personal': {
            'title': 'Impots des particuliers',
            'items': {
              'method': 'Taux effectifs moyens',
              'baseRate': 'Taux de base 21% (2024)',
              'baseAmount': 'Variation 10 G$ par point',
              'totalRevenue': 'Recettes totales 210 G$',
              'range': 'Plage 0% a 50%',
              'credits': 'Credits ajustables'
            }
          },
          'corporate': {
            'title': 'Impots des societes',
            'items': {
              'method': 'Structure simplifiee',
              'baseRate': 'Taux de base 15% (2024)',
              'baseAmount': 'Variation 5,33 G$ par point',
              'totalRevenue': 'Recettes totales 80 G$',
              'range': 'Plage 0% a 40%',
              'expenditures': 'Depenses fiscales ajustables'
            }
          },
          'taxExpenditures': {
            'title': 'Depenses fiscales et credits',
            'personal': {
              'title': 'Credits personnels',
              'items': {
                'baseAmount': 'Montant brut 120 G$',
                'netAmount': 'Montant net 102 G$',
                'impact': 'Peuvent ajuster les recettes des particuliers'
              }
            },
            'corporate': {
              'title': 'Depenses fiscales corporatives',
              'items': {
                'baseAmount': 'Montant brut 25 G$',
                'netAmount': 'Montant net 23,75 G$',
                'impact': 'Peuvent ajuster les recettes des societes'
              }
            }
          },
          'summary': 'Approche simplifiee pour suivre l impact fiscal global.'
        }
      },
      'faq': {
        'a1': 'Estimation simplifiee basee sur vos donnees.',
        'a2': 'Calculs locaux dans votre navigateur, aucune donnee stockee.',
        'a3': 'Mise a jour annuelle selon les nouveaux taux.',
        'a4': 'Cible l impot des particuliers, pas les entreprises.',
        'a5': 'Allocations issues des Comptes publics et du Budget 2024.',
        'a6': 'Inclut les principaux credits mais pas tous les credits possibles.',
        'a7': 'Montre l effet sur deficit, surplus et dette PIB.',
        'a8': 'Equilibrage auto ajuste les recettes automatiquement.',
        'a9': 'Exportez votre plan budgetaire en PDF.',
        'a10': 'Modeles simplifies, interactions economiques non exhaustives.',
        'a11': 'Info bulles detaillees sur chaque categorie.'
      }
    },
    'tour': {
      'steps': {
        'moreMobile': {
          'title': 'Plus',
          'body': 'Sur mobile, les onglets additionnels sont sous Plus.'
        },
        'exportOptions': {
          'title': 'Options d export',
          'body': 'Activer Inclure la ventilation puis telecharger le PDF.'
        },
        'spendingTaxExp': {
          'title': 'Depenses fiscales',
          'body': 'Credits et deductions qui reduisent les recettes.'
        },
        'spendingReset': {
          'title': 'Reinitialiser',
          'body': 'Chaque tuile possede un bouton retour au point de reference.'
        },
        'resultsDeficit': {
          'title': 'Avertissements',
          'body': 'De grands deficits declenchent un avertissement.'
        },
        'resultsDownload': {
          'title': 'Telecharger',
          'body': 'Utiliser le bouton telechargement pour sauvegarder les graphiques.'
        }
      }
    },
    'simulator': {
      'yearSelector': {
        'aria': 'Selecteur d exercice fiscal',
        'labels': {
          'y2024': '2023-2024'
        }
      }
    }
  }
}


function deepMerge(target, source) {
  if (!source) return target
  for (const key of Object.keys(source)) {
    const srcValue = source[key]
    const tgtValue = target[key]
    if (srcValue && typeof srcValue === 'object' && !Array.isArray(srcValue)) {
      target[key] = deepMerge(tgtValue && typeof tgtValue === 'object' ? tgtValue : {}, srcValue)
    } else {
      target[key] = srcValue
    }
  }
  return target
}

const messages = { en: deepMerge(en, overrides.en), fr: deepMerge(fr, overrides.fr) }

function resolveLocale() {
  if (typeof window === 'undefined') return 'en'
  try {
    const stored = window.localStorage.getItem('locale')
    if (stored && messages[stored]) return stored
  } catch (err) {
    // ignore storage errors
  }
  const browser = typeof navigator !== 'undefined' && navigator.language
    ? navigator.language.split('-')[0]
    : 'en'
  return messages[browser] ? browser : 'en'
}

const locale = ref(resolveLocale())

function setLocale(next) {
  if (messages[next]) {
    locale.value = next
    try {
      window.localStorage.setItem('locale', next)
    } catch (err) {
      // ignore storage errors
    }
  }
}

function get(obj, path) {
  return path.split('.').reduce((acc, key) => (acc && acc[key] != null ? acc[key] : undefined), obj)
}

function format(str, params) {
  if (!params || typeof str !== 'string') return str
  return str.replace(/\{(\w+)\}/g, (_, key) => (key in params ? String(params[key]) : `{${key}}`))
}

function translate(key, params) {
  const current = get(messages[locale.value] || {}, key)
  if (typeof current === 'string') return format(current, params)
  const fallback = get(messages.en || {}, key)
  if (typeof fallback === 'string') return format(fallback, params)
  return key
}

export function useI18n() {
  const t = (key, params) => translate(key, params)
  return { t, locale }
}

export default {
  install(app) {
    app.config.globalProperties.$t = (key, params) => translate(key, params)
    app.provide('i18n-locale', locale)
    app.provide('t', (key, params) => translate(key, params))
  },
  useI18n,
  locale,
  setLocale
}
